!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).geojsonvt=e()}}(function(){return function e(t,n,i){function o(s,u){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!u&&l)return l(s,!0);if(r)return r(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return o(n||e)},f,f.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){"use strict";function i(e,t,n,i,o){for(var r=0;r<e.length;r+=3){var s=e[r+o];s>=n&&s<=i&&(t.push(e[r]),t.push(e[r+1]),t.push(e[r+2]))}}function o(e,t,n,i,o,r){for(var a=[],f=0===o?u:l,h=0;h<e.length-3;h+=3){var m=e[h],p=e[h+1],g=e[h+2],c=e[h+3],d=e[h+4],v=0===o?m:p,x=0===o?c:d,y=!1;v<n?x>=n&&f(a,m,p,c,d,n):v>i?x<=i&&f(a,m,p,c,d,i):s(a,m,p,g),x<n&&v>=n&&(f(a,m,p,c,d,n),y=!0),x>i&&v<=i&&(f(a,m,p,c,d,i),y=!0),!r&&y&&(a.size=e.size,t.push(a),a=[])}var M=e.length-3;m=e[M],p=e[M+1],g=e[M+2],(v=0===o?m:p)>=n&&v<=i&&s(a,m,p,g),M=a.length-3,r&&M>=3&&(a[M]!==a[0]||a[M+1]!==a[1])&&s(a,a[0],a[1],a[2]),a.length&&(a.size=e.size,t.push(a))}function r(e,t,n,i,r,s){for(var u=0;u<e.length;u++)o(e[u],t,n,i,r,s)}function s(e,t,n,i){e.push(t),e.push(n),e.push(i)}function u(e,t,n,i,o,r){e.push(r),e.push(n+(r-t)*(o-n)/(i-t)),e.push(1)}function l(e,t,n,i,o,r){e.push(t+(r-n)*(i-t)/(o-n)),e.push(r),e.push(1)}t.exports=function(e,t,n,s,u,l,f){if(n/=t,s/=t,l>=n&&f<=s)return e;if(l>s||f<n)return null;for(var h=[],m=0;m<e.length;m++){var p=e[m],g=p.geometry,c=p.type,d=0===u?p.minX:p.minY,v=0===u?p.maxX:p.maxY;if(d>=n&&v<=s)h.push(p);else if(!(d>s||v<n)){var x=[];if("Point"===c||"MultiPoint"===c)i(g,x,n,s,u);else if("LineString"===c)o(g,x,n,s,u,!1);else if("MultiLineString"===c)r(g,x,n,s,u,!1);else if("Polygon"===c)r(g,x,n,s,u,!0);else if("MultiPolygon"===c)for(var y=0;y<g.length;y++){var M=[];r(g[y],M,n,s,u,!0),M.length&&x.push(M)}x.length&&("LineString"!==c&&"MultiLineString"!==c||(1===x.length?(c="LineString",x=x[0]):c="MultiLineString"),"Point"!==c&&"MultiPoint"!==c||(c=3===x.length?"Point":"MultiPoint"),h.push(a(p.id,c,x,p.tags)))}}return h.length?h:null};var a=e("./feature")},{"./feature":3}],2:[function(e,t,n){"use strict";function i(e,t,n){if(t.geometry){var u=t.geometry.coordinates,l=t.geometry.type,a=n*n,h=[];if("Point"===l)o(u,h);else if("MultiPoint"===l)for(var m=0;m<u.length;m++)o(u[m],h);else if("LineString"===l)r(u,h,a,!1);else if("MultiLineString"===l)s(u,h,a,!1);else if("Polygon"===l)s(u,h,a,!0);else{if("MultiPolygon"!==l){if("GeometryCollection"===l){for(m=0;m<t.geometry.geometries.length;m++)i(e,{geometry:t.geometry.geometries[m],properties:t.properties},n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(m=0;m<u.length;m++){var p=[];s(u[m],p,a,!0),h.push(p)}}e.push(f(t.id,l,h,t.properties))}}function o(e,t){t.push(u(e[0])),t.push(l(e[1])),t.push(0)}function r(e,t,n,i){for(var o,r,s=0,f=0;f<e.length;f++){var h=u(e[f][0]),m=l(e[f][1]);t.push(h),t.push(m),t.push(0),f>0&&(s+=i?(o*m-h*r)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(m-r,2))),o=h,r=m}var p=t.length-3;t[2]=1,a(t,0,p,n),t[p+2]=1,t.size=Math.abs(s)}function s(e,t,n,i){for(var o=0;o<e.length;o++){var s=[];r(e[o],s,n,i),t.push(s)}}function u(e){return e/360+.5}function l(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}t.exports=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)i(n,e.features[o],t);else"Feature"===e.type?i(n,e,t):i(n,{geometry:e},t);return n};var a=e("./simplify"),f=e("./feature")},{"./feature":3,"./simplify":5}],3:[function(e,t,n){"use strict";function i(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)o(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<t.length;i++)o(e,t[i]);else if("MultiPolygon"===n)for(i=0;i<t.length;i++)for(var r=0;r<t[i].length;r++)o(e,t[i][r])}function o(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}t.exports=function(e,t,n,o){var r={id:e||null,type:t,geometry:n,tags:o,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return i(r),r}},{}],4:[function(e,t,n){"use strict";function i(e,t){var n=(t=this.options=r(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");var i=1<<t.maxZoom,o=s(e,t.tolerance/(i*t.extent));this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(o=a(o,t.buffer/t.extent)).length&&this.splitTile(o,0,0,0),n&&(o.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function o(e,t,n){return 32*((1<<e)*n+t)+e}function r(e,t){for(var n in t)e[n]=t[n];return e}t.exports=function(e,t){return new i(e,t)};var s=e("./convert"),u=e("./transform"),l=e("./clip"),a=e("./wrap"),f=e("./tile");i.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,debug:0},i.prototype.splitTile=function(e,t,n,i,r,s,u){for(var a=[e,t,n,i],h=this.options,m=h.debug;a.length;){i=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var p=1<<t,g=o(t,n,i),c=this.tiles[g],d=t===h.maxZoom?0:h.tolerance/(p*h.extent);if(!c&&(m>1&&console.time("creation"),c=this.tiles[g]=f(e,p,n,i,d,t===h.maxZoom),this.tileCoords.push({z:t,x:n,y:i}),m)){m>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,c.numFeatures,c.numPoints,c.numSimplified),console.timeEnd("creation"));var v="z"+t;this.stats[v]=(this.stats[v]||0)+1,this.total++}if(c.source=e,r){if(t===h.maxZoom||t===r)continue;var x=1<<r-t;if(n!==Math.floor(s/x)||i!==Math.floor(u/x))continue}else if(t===h.indexMaxZoom||c.numPoints<=h.indexMaxPoints)continue;if(c.source=null,0!==e.length){m>1&&console.time("clipping");var y,M,P,Y,S,X,w=.5*h.buffer/h.extent,L=.5-w,z=.5+w,b=1+w;y=M=P=Y=null,S=l(e,p,n-w,n+z,0,c.minX,c.maxX),X=l(e,p,n+L,n+b,0,c.minX,c.maxX),e=null,S&&(y=l(S,p,i-w,i+z,1,c.minY,c.maxY),M=l(S,p,i+L,i+b,1,c.minY,c.maxY),S=null),X&&(P=l(X,p,i-w,i+z,1,c.minY,c.maxY),Y=l(X,p,i+L,i+b,1,c.minY,c.maxY),X=null),m>1&&console.timeEnd("clipping"),a.push(y||[],t+1,2*n,2*i),a.push(M||[],t+1,2*n,2*i+1),a.push(P||[],t+1,2*n+1,2*i),a.push(Y||[],t+1,2*n+1,2*i+1)}}},i.prototype.getTile=function(e,t,n){var i=this.options,r=i.extent,s=i.debug;if(e<0||e>24)return null;var l=1<<e,a=o(e,t=(t%l+l)%l,n);if(this.tiles[a])return u.tile(this.tiles[a],r);s>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var f,h=e,m=t,p=n;!f&&h>0;)h--,m=Math.floor(m/2),p=Math.floor(p/2),f=this.tiles[o(h,m,p)];return f&&f.source?(s>1&&console.log("found parent tile z%d-%d-%d",h,m,p),s>1&&console.time("drilling down"),this.splitTile(f.source,h,m,p,e,t,n),s>1&&console.timeEnd("drilling down"),this.tiles[a]?u.tile(this.tiles[a],r):null):null}},{"./clip":1,"./convert":2,"./tile":6,"./transform":7,"./wrap":8}],5:[function(e,t,n){"use strict";function i(e,t,n,r){for(var s,u=r,l=e[t],a=e[t+1],f=e[n],h=e[n+1],m=t+3;m<n;m+=3){var p=o(e[m],e[m+1],l,a,f,h);p>u&&(s=m,u=p)}u>r&&(s-t>3&&i(e,t,s,r),e[s+2]=u,n-s>3&&i(e,s,n,r))}function o(e,t,n,i,o,r){var s=o-n,u=r-i;if(0!==s||0!==u){var l=((e-n)*s+(t-i)*u)/(s*s+u*u);l>1?(n=o,i=r):l>0&&(n+=s*l,i+=u*l)}return s=e-n,u=t-i,s*s+u*u}t.exports=i},{}],6:[function(e,t,n){"use strict";function i(e,t,n,i){var r=t.geometry,s=t.type,u=[];if("Point"===s||"MultiPoint"===s)for(var l=0;l<r.length;l+=3)u.push(r[l]),u.push(r[l+1]),e.numPoints++,e.numSimplified++;else if("LineString"===s)o(u,r,e,n,i,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(l=0;l<r.length;l++)o(u,r[l],e,n,i,"Polygon"===s,0===l);else if("MultiPolygon"===s)for(var a=0;a<r.length;a++){var f=r[a];for(l=0;l<f.length;l++)o(u,f[l],e,n,i,!0,0===l)}if(u.length){var h={geometry:u,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:t.tags||null};null!==t.id&&(h.id=t.id),e.features.push(h)}}function o(e,t,n,i,o,s,u){var l=i*i;if(!o&&t.size<(s?l:i))n.numPoints+=t.length/3;else{for(var a=[],f=0;f<t.length;f+=3)(o||t[f+2]>l)&&(n.numSimplified++,a.push(t[f]),a.push(t[f+1])),n.numPoints++;s&&r(a,u),e.push(a)}}function r(e,t){for(var n=0,i=0,o=e.length,r=o-2;i<o;r=i,i+=2)n+=(e[i]-e[r])*(e[i+1]+e[r+1]);if(n>0===t)for(i=0,o=e.length;i<o/2;i+=2){var s=e[i],u=e[i+1];e[i]=e[o-2-i],e[i+1]=e[o-1-i],e[o-2-i]=s,e[o-1-i]=u}}t.exports=function(e,t,n,o,r,s){for(var u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:o,z2:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){u.numFeatures++,i(u,e[l],r,s);var a=e[l].minX,f=e[l].minY,h=e[l].maxX,m=e[l].maxY;a<u.minX&&(u.minX=a),f<u.minY&&(u.minY=f),h>u.maxX&&(u.maxX=h),m>u.maxY&&(u.maxY=m)}return u}},{}],7:[function(e,t,n){"use strict";function i(e,t,n,i,o,r){return[Math.round(n*(e*i-o)),Math.round(n*(t*i-r))]}n.tile=function(e,t){if(e.transformed)return e;var n,o,r,s=e.z2,u=e.x,l=e.y;for(n=0;n<e.features.length;n++){var a=e.features[n],f=a.geometry,h=a.type;if(a.geometry=[],1===h)for(o=0;o<f.length;o+=2)a.geometry.push(i(f[o],f[o+1],t,s,u,l));else for(o=0;o<f.length;o++){var m=[];for(r=0;r<f[o].length;r+=2)m.push(i(f[o][r],f[o][r+1],t,s,u,l));a.geometry.push(m)}}return e.transformed=!0,e},n.point=i},{}],8:[function(e,t,n){"use strict";function i(e,t){for(var n=[],i=0;i<e.length;i++){var r,u=e[i],l=u.type;if("Point"===l||"MultiPoint"===l||"LineString"===l)r=o(u.geometry,t);else if("MultiLineString"===l||"Polygon"===l){r=[];for(var a=0;a<u.geometry.length;a++)r.push(o(u.geometry[a],t))}else if("MultiPolygon"===l)for(r=[],a=0;a<u.geometry.length;a++){for(var f=[],h=0;h<u.geometry[a].length;h++)f.push(o(u.geometry[a][h],t));r.push(f)}n.push(s(u.id,l,r,u.tags))}return n}function o(e,t){var n=[];n.size=e.size;for(var i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}var r=e("./clip"),s=e("./feature");t.exports=function(e,t){var n=e,o=r(e,1,-1-t,t,0,-1,2),s=r(e,1,1-t,2+t,0,-1,2);return(o||s)&&(n=r(e,1,-t,1+t,0,-1,2)||[],o&&(n=i(o,1).concat(n)),s&&(n=n.concat(i(s,-1)))),n}},{"./clip":1,"./feature":3}]},{},[4])(4)});